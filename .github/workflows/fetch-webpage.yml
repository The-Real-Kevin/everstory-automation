name: Download Homepage Every 5 Minutes

on:
  schedule:
    - cron: '0 * * * *'  # Every hour
  workflow_dispatch:

jobs:
  download:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4
      
      - name: ğŸŒ Download page
        run: |
          mkdir -p downloads
          TIMESTAMP=$(date +"%Y%m%d_%H%M%S")
          curl -L https://the-real-kevin.github.io -o downloads/homepage_${TIMESTAMP}.html
          cp downloads/homepage_${TIMESTAMP}.html downloads/homepage_latest.html
          echo "Downloaded at ${TIMESTAMP}"
          ls -lh downloads/homepage_latest.html
      
      - name: ğŸ“¤ Upload
        uses: actions/upload-artifact@v4
        with:
          name: homepage-${{ github.run_number }}
          path: downloads/*.html
          retention-days: 3

      - name: ğŸ”„ Check for changes
        run: |
          if [ -f downloads/homepage_previous.html ]; then
            if diff downloads/homepage_latest.html downloads/homepage_previous.html > /dev/null; then
              echo "âœ… No changes detected"
            else
              echo "ğŸ†• Page has changed!"
            fi
          else
            echo "ğŸ“ First run - no previous version to compare"
          fi
          
          # Save current as previous for next run
          cp downloads/homepage_latest.html downloads/homepage_previous.html